<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>
</head>
<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="main" style="height:400px"></div>
    <!-- 因为连js都会被打包到可执行程序中，所以这里引入echarts-all.js而不是require动态加载 -->
    <script src="build/dist/json2.js"></script>
    <script src="build/dist/echarts-all.js"></script>
    <script type="text/javascript">
    
    // 基于准备好的dom，初始化echarts图表, macarons是echarts主题，换样式的，可略
    var myChart = echarts.init(document.getElementById('main'),'macarons'); 
    // 组织option
   var option = {
        title : {
            text: '' //名字由qt传进来
        },
        tooltip:{
            show : true,
            trigger: 'axis',  // 坐标轴触发 也可以item数据点触发
            formatter:function (params){ // tip的样式
                var res = '时间 : ' + params[0].name +'<br/>';
                for (var i = 0, l = params.length; i < l; i++) {
                    res += '<br/>' + params[i].seriesName + ' : ' + params[i].value;
                }    
                return res;
            }
        },
        calculable : false,
        xAxis : [
            {
                type : 'category',
                boundaryGap : false,
                axisLabel:{interval:0},
                data : []
            }
        ],
        yAxis : [
            {
                type : 'value'
            }
        ],
        series : [
            {
                name:'今日',
                type:'line',
                data:[]
            }
        ]
    };        
    
	function ShowMessageBox(value1, value2) {  
        return value1;  
         } 
    // 为echarts对象加载数据 
	function callfromqt2(value1, value2)
	{
		alert("1234");
	}
    function callfromqt(value1,str)
    {
		alert(str);
		var obj = JSON.parse(str); // 可能我的QT版本有点低，webkit不能支持原生的JSON.parse
		//document.write(obj.title);
		
        if (obj.value.length < 1)
               return value1;
        
        option.title.text=obj.title;       
        option.series[0].data =  obj.value;  
		
        // 下面是根据传入的采样点数拼坐标轴 可略
        option.xAxis[0].data = getDayXAsis(obj.value.length);
        if ( option.xAxis[0].data.length > 12)
            option.xAxis[0].axisLabel.interval = option.xAxis[0].data.length/12 -1;
        else
            option.xAxis[0].axisLabel.interval = 0;
        //
        // 画折线图    
        myChart.setOption(option); 
		    //窗体自适应    
        window.onresize = myChart.resize;  
		return value1;
    }
             
    // 根据数据点数创建日曲线的x轴标签
    function getDayXAsis(split_num)
    {
        var xasis = [];
        // 如果是288点就5分钟一个标签 96点就15分钟一个标签
        var offset = 86400/split_num;
        var d = new Date(1999, 1, 1);
        for (var i=0; i<split_num; i++)
        {
            var nd = new Date();
            nd.setTime(d.getTime() +offset*1000*i);    
            var str = compZero(nd.getHours(),2)+":"+compZero(nd.getMinutes(),2);
            xasis.push(str);
        }
        return xasis;
    }
            
    // 左补0
    function compZero(intn, bits)
    {
        var int_str = "" + intn;
        if (int_str.length >= bits)
                return int_str;
                
        var comp_str = "";
        var comp_len = bits - int_str.length;
        for (var i=0; i<comp_len; i++)
            comp_str += "0";
                
        comp_str += int_str;
            return comp_str;
    }
    
    </script>
</body>